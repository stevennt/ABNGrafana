{"version":3,"sources":["../src/legend.js"],"names":[],"mappings":"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","file":"legend.js","sourcesContent":["'use strict';\n\nimport angular from 'angular';\nimport _ from 'lodash';\nimport $ from 'jquery';\n\nangular.module('grafana.directives').directive('heatmapEpochLegend', function(popoverSrv, $timeout) {\n\n  return {\n    link: function(scope, elem) {\n      var $container = $('<section class=\"graph-legend\"></section>');\n      var firstRender = true;\n      var ctrl = scope.ctrl;\n      var panel = ctrl.panel;\n      var data;\n      var seriesList;\n      var i;\n\n      ctrl.events.on('render', function() {\n        data = ctrl.seriesList;\n        if (data) {\n          render();\n        }\n      });\n\n      function getSeriesIndexForElement(el) {\n        return el.parents('[data-series-index]').data('series-index');\n      }\n\n      function toggleSeries(e) {\n        var el = $(e.currentTarget);\n        var index = getSeriesIndexForElement(el);\n        var seriesInfo = seriesList[index];\n        ctrl.toggleSeries(seriesInfo, e);\n      }\n\n      function sortLegend(e) {\n        var el = $(e.currentTarget);\n        var stat = el.data('stat');\n\n        if (stat !== panel.legend.sort) { panel.legend.sortDesc = null; }\n\n        // if already sort ascending, disable sorting\n        if (panel.legend.sortDesc === false) {\n          panel.legend.sort = null;\n          panel.legend.sortDesc = null;\n          render();\n          return;\n        }\n\n        panel.legend.sortDesc = !panel.legend.sortDesc;\n        panel.legend.sort = stat;\n        render();\n      }\n\n      function getTableHeaderHtml(statName) {\n        if (!panel.legend[statName]) { return \"\"; }\n        var html = '<th class=\"pointer\" data-stat=\"' + statName + '\">' + statName;\n\n        if (panel.legend.sort === statName) {\n          var cssClass = panel.legend.sortDesc ? 'fa fa-caret-down' : 'fa fa-caret-up' ;\n          html += ' <span class=\"' + cssClass + '\"></span>';\n        }\n\n        return html + '</th>';\n      }\n\n      function render() {\n        if (!ctrl.panel.legend.show) {\n          elem.empty();\n          firstRender = true;\n          return;\n        }\n\n        if (firstRender) {\n          elem.append($container);\n          $container.on('click', '.graph-legend-alias', toggleSeries);\n          $container.on('click', 'th', sortLegend);\n          firstRender = false;\n        }\n\n        seriesList = data;\n\n        $container.empty();\n\n        // Set min-width if side style and there is a value, otherwise remove the CSS propery\n        var width = panel.legend.rightSide && panel.legend.sideWidth ? panel.legend.sideWidth + \"px\" : \"\";\n        $container.css(\"min-width\", width);\n\n        $container.toggleClass('graph-legend-table', panel.legend.alignAsTable === true);\n\n        if (panel.legend.alignAsTable) {\n          var header = '<tr>';\n          header += '<th colspan=\"2\" style=\"text-align:left\"></th>';\n          if (panel.legend.values) {\n            header += getTableHeaderHtml('min');\n            header += getTableHeaderHtml('max');\n            header += getTableHeaderHtml('avg');\n            header += getTableHeaderHtml('current');\n            header += getTableHeaderHtml('total');\n          }\n          header += '</tr>';\n          $container.append($(header));\n        }\n\n        if (panel.legend.sort) {\n          seriesList = _.sortBy(seriesList, function(series) {\n            return series.stats[panel.legend.sort];\n          });\n          if (panel.legend.sortDesc) {\n            seriesList = seriesList.reverse();\n          }\n        }\n\n        var seriesShown = 0;\n        for (i = 0; i < seriesList.length; i++) {\n          var series = seriesList[i];\n\n          if (series.hideFromLegend(panel.legend)) {\n            continue;\n          }\n\n          var html = '<div class=\"graph-legend-series';\n          if (series.yaxis === 2) { html += ' graph-legend-series--right-y'; }\n          if (ctrl.hiddenSeries[series.alias]) { html += ' graph-legend-series-hidden'; }\n          html += '\" data-series-index=\"' + i + '\">';\n          html += '<div class=\"graph-legend-icon\">';\n          html += '<i class=\"fa fa-minus pointer\" style=\"color:' + series.color + '\"></i>';\n          html += '</div>';\n\n          html += '<a class=\"graph-legend-alias pointer\">' + _.escape(series.label) + '</a>';\n\n          if (panel.legend.values) {\n            var avg = series.formatValue(series.stats.avg);\n            var current = series.formatValue(series.stats.current);\n            var min = series.formatValue(series.stats.min);\n            var max = series.formatValue(series.stats.max);\n            var total = series.formatValue(series.stats.total);\n\n            if (panel.legend.min) { html += '<div class=\"graph-legend-value min\">' + min + '</div>'; }\n            if (panel.legend.max) { html += '<div class=\"graph-legend-value max\">' + max + '</div>'; }\n            if (panel.legend.avg) { html += '<div class=\"graph-legend-value avg\">' + avg + '</div>'; }\n            if (panel.legend.current) { html += '<div class=\"graph-legend-value current\">' + current + '</div>'; }\n            if (panel.legend.total) { html += '<div class=\"graph-legend-value total\">' + total + '</div>'; }\n          }\n\n          html += '</div>';\n          $container.append($(html));\n\n          seriesShown++;\n        }\n\n        if (panel.legend.alignAsTable) {\n          var maxHeight = ctrl.height;\n\n          if (!panel.legend.rightSide) {\n            maxHeight = maxHeight/2;\n          }\n\n          var topPadding = 6;\n          $container.css(\"max-height\", maxHeight - topPadding);\n        } else {\n          $container.css(\"max-height\", \"\");\n        }\n\n        ctrl.legendWidth = $container.width();\n      }\n    }\n  };\n});\n"]}