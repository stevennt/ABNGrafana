{"version":3,"sources":["../src/heatmap.js"],"names":[],"mappings":"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","file":"heatmap.js","sourcesContent":["import angular from 'angular';\nimport $ from 'jquery';\nimport moment from 'moment';\nimport _ from 'lodash';\nimport kbn from 'app/core/utils/kbn';\nimport './bower_components/d3/d3.min.js';\nimport './bower_components/epoch/dist/js/epoch.min.js';\n\nangular.module('grafana.directives').directive('grafanaHeatmapEpoch', function($rootScope, timeSrv) {\n  return {\n    restrict: 'A',\n    template: '<div> </div>',\n    link: function(scope, elem) {\n      var ctrl = scope.ctrl;\n      var dashboard = ctrl.dashboard;\n      var panel = ctrl.panel;\n      var data;\n      var sortedSeries;\n      var legendSideLastValue = null;\n      var rootScope = scope.$root;\n      var epoch = null;\n      var firstDraw = true;\n      var delta = true;\n      var labelToModelIndexMap = {};\n      var currentDatasource = '';\n      var currentTimeRange = [0, 0];\n      var currentSize = { width: null, height: null };\n      var currentBucketRange = [null, null];\n\n      // Receive render events\n      ctrl.events.on('render', function(renderData) {\n        data = renderData || data;\n        if (!data) {\n          ctrl.refresh();\n          return;\n        }\n        render_panel();\n      });\n\n      function getLegendHeight(panelHeight) {\n        if (!panel.legend.show || panel.legend.rightSide) {\n          return 2;\n        }\n\n        if (panel.legend.alignAsTable) {\n          var legendSeries = _.filter(data, function(series) {\n            return series.hideFromLegend(panel.legend) === false;\n          });\n          var total = 23 + (22 * legendSeries.length);\n          return Math.min(total, Math.floor(panelHeight/2));\n        } else {\n          return 26;\n        }\n      }\n\n      function setElementHeight() {\n        try {\n          var height = ctrl.height - getLegendHeight(ctrl.height);\n          elem.css('height', height + 'px');\n\n          return true;\n        } catch(e) { // IE throws errors sometimes\n          console.log(e);\n          return false;\n        }\n      }\n\n      function shouldAbortRender() {\n        if (!data || _.isEmpty(data)) {\n          return true;\n        }\n\n        if (!setElementHeight()) { return true; }\n\n        if (elem.width() === 0) {\n          return true;\n        }\n      }\n\n      function processOffsetHook(plot, gridMargin) {\n        var left = panel.yaxes[0];\n        var right = panel.yaxes[1];\n        if (left.show && left.label) { gridMargin.left = 20; }\n        if (right.show && right.label) { gridMargin.right = 20; }\n      }\n\n      function getEpoch() {\n        if (epoch) {\n          return epoch;\n        }\n\n        var defaultWindowSize = 60;\n        var defaultBuckets = 10;\n\n        var options = angular.copy(panel.heatmapOptions);\n        if (!_.isNumber(options.windowSize)) {\n          options.windowSize = defaultWindowSize;\n        }\n        if (!_.isNumber(options.buckets)) {\n          options.buckets = defaultBuckets;\n        }\n        epoch = elem.epoch(options);\n        scope.$watch('ctrl.panel.heatmapOptions.windowSize', function(newVal, oldVal) {\n          if (!_.isNumber(newVal)) {\n            newVal = defaultWindowSize;\n          }\n          epoch.option('windowSize', newVal);\n          epoch.option('historySize', newVal * 3);\n          epoch.redraw();\n        });\n        scope.$watch('ctrl.panel.heatmapOptions.buckets', function(newVal, oldVal) {\n          if (!_.isNumber(newVal)) {\n            newVal = defaultBuckets;\n          }\n          epoch.option('buckets', newVal);\n        });\n        scope.$watch('ctrl.panel.heatmapOptions.bucketRange[0]', function(newVal, oldVal) {\n          if (_.isNumber(newVal)) {\n            epoch.option('bucketRange', panel.heatmapOptions.bucketRange);\n          }\n        });\n        scope.$watch('ctrl.panel.heatmapOptions.bucketRange[1]', function(newVal, oldVal) {\n          if (_.isNumber(newVal)) {\n            epoch.option('bucketRange', panel.heatmapOptions.bucketRange);\n          }\n        });\n        scope.$watch('ctrl.panel.heatmapOptions.startTime', function(newVal, oldVal) {\n          epoch.option('startTime', newVal);\n          epoch.redraw();\n        });\n\n        return epoch;\n      }\n\n      function resize(width, height) {\n        if (width !== currentSize.width) {\n          epoch.option('width', width);\n          var ticksTime = Math.floor(epoch.option('windowSize') * 30 * 2 / width);\n          epoch.option('ticks.time', ticksTime);\n          epoch.ticksChanged();\n        }\n        if (height !== currentSize.height) {\n          epoch.option('height', height);\n        }\n        currentSize.width = width;\n        currentSize.height = height;\n      }\n\n      function getHeatmapData(datapoints, delta) {\n        var epoch = getEpoch();\n        var windowInterval = Math.floor((ctrl.range.to - ctrl.range.from) / epoch.option('windowSize'));\n        var groupedData = _.chain(datapoints)\n        .reject(function(dp) {\n          return dp[0] === null;\n        })\n        .groupBy(function(dp) {\n          return Math.floor((dp[1] - ctrl.range.from) / windowInterval) + 1;\n        }).value();\n\n        var data = [];\n        var n;\n        var keys = _.keys(groupedData);\n        var min = delta ? _.min(keys) : 1;\n        var max = delta ? _.max(keys) : epoch.option('windowSize') + 1;\n        for (n = min; n <= max; n++) {\n          var values = groupedData[n] || [];\n\n          data.push({\n            time: Math.floor((n * windowInterval + ctrl.range.from) / 1000),\n            histogram: _.countBy(values, function(value) {\n              return value[0];\n            })\n          });\n        }\n\n        if (data.length > epoch.option('windowSize')) {\n          data[epoch.option('windowSize')].histogram = {};\n        }\n\n        return data;\n      }\n\n      function getBucketRangeFromData(seriesData, currentBucketRange) {\n        var min = Number.MAX_VALUE;\n        var max = Number.MIN_VALUE;\n\n        if (_.isNumber(currentBucketRange[0])) {\n          min = currentBucketRange[0];\n        }\n        if (_.isNumber(currentBucketRange[1])) {\n          max = currentBucketRange[1];\n        }\n\n        _.each(seriesData, function(series) {\n          _.each(series.values, function(value) {\n            if (_.isEmpty(value.histogram)) {\n              return;\n            }\n            var keys = _.keys(value.histogram);\n            min = _.min([min, _.min(keys)]);\n            max = _.max([max, _.max(keys)]);\n          });\n        });\n\n        if (!(min === Number.MAX_VALUE || max === Number.MIN_VALUE)) {\n          return [parseInt(min, 10), parseInt(max, 10)];\n        } else {\n          return [0, 0];\n        }\n      }\n\n      function callPlot(incrementRenderCounter, data) {\n        try {\n          epoch.setData(data);\n\n          _.each(data, function(d) {\n            epoch.showLayer(d.label);\n            if (ctrl.hiddenSeries[d.alias]) {\n              epoch.hideLayer(d.label);\n            }\n          });\n\n          if (ctrl.range.from !== currentTimeRange[0] || ctrl.range.to !== currentTimeRange[1]) {\n            var ticks = Math.ceil(epoch.option('windowSize') / epoch.option('ticks.time'));\n            var min = _.isUndefined(ctrl.range.from) ? null : ctrl.range.from.valueOf();\n            var max = _.isUndefined(ctrl.range.to) ? null : ctrl.range.to.valueOf();\n            epoch.option('tickFormats.bottom', function (d) {\n              var timeFormat = time_format(ticks, min, max);\n              var time = moment.unix(d);\n              if (dashboard.getTimezone() === 'utc') {\n                time = time.utc();\n              }\n              return time.format(timeFormat);\n            });\n            epoch.ticksChanged();\n          }\n          currentTimeRange = [ctrl.range.from, ctrl.range.to];\n\n          epoch.redraw();\n        } catch (e) {\n          console.log('epoch error', e);\n        }\n\n        if (incrementRenderCounter) {\n          ctrl.renderingCompleted();\n        }\n      }\n\n      // Function for rendering panel\n      function render_panel() {\n        if (shouldAbortRender()) {\n          return;\n        }\n\n        // reset startTime if datasource is changed\n        if (panel.datasource !== currentDatasource) {\n          panel.heatmapOptions.startTime = Math.floor(ctrl.range.from.valueOf() / 1000);\n          firstDraw = true;\n        }\n        currentDatasource = panel.datasource;\n\n        var epoch = getEpoch();\n\n        // check panel size change\n        var width = elem.parent().width();\n        var height = elem.parent().height();\n        resize(width, height);\n\n        if (firstDraw) {\n          delta = true;\n          var seriesData = _.map(data, function (series) {\n            delta = delta && series.unit; // use unit as delta temporaly, if all series is delta, enable realtime chart\n            var epochLabel = ctrl.getEpochLabel(series.label);\n\n            return {\n              alias: series.label,\n              label: epochLabel,\n              values: getHeatmapData(series.datapoints, false)\n            };\n          });\n\n          if (!_.isNumber(panel.heatmapOptions.bucketRange[0])\n            || !_.isNumber(panel.heatmapOptions.bucketRange[1])) {\n            currentBucketRange = [panel.heatmapOptions.bucketRange[0], panel.heatmapOptions.bucketRange[1]];\n            currentBucketRange = getBucketRangeFromData(seriesData, currentBucketRange);\n            epoch.option('bucketRange', currentBucketRange);\n          }\n\n          if (shouldDelayDraw(panel)) {\n            setTimeout(function() {\n              // fix right legend\n              if (panel.legend.rightSide && panel.legend.rightSide !== legendSideLastValue) {\n                width -= ctrl.legendWidth;\n                height = ctrl.height;\n              }\n              resize(width, height);\n\n              callPlot(true, seriesData);\n\n              legendSideLastValue = panel.legend.rightSide;\n            }, 50);\n          } else {\n            callPlot(true, seriesData);\n          }\n\n          // create model index for realtime graph\n          if (delta) {\n            firstDraw = false;\n\n            labelToModelIndexMap = {};\n            _.each(data, function (series, i) {\n              labelToModelIndexMap[series.label] = i;\n            });\n          }\n        } else if (delta) { // realtime graph\n          var indexedData = [];\n          var dataLength = 0;\n          _.each(data, function (series) {\n            if (_.isUndefined(labelToModelIndexMap[series.label])) {\n              return;\n            }\n\n            var values = getHeatmapData(series.datapoints, true);\n            indexedData[labelToModelIndexMap[series.label]] = {\n              values: values\n            };\n\n            if (dataLength < values.length) {\n              dataLength = values.length;\n            }\n          });\n\n          var bucketRange = getBucketRangeFromData(indexedData, currentBucketRange);\n          if (bucketRange[0] !== currentBucketRange[0]\n            || bucketRange[1] !== currentBucketRange[1]) {\n            currentBucketRange = bucketRange;\n            epoch.option('bucketRange', currentBucketRange);\n          }\n\n          if (!_.isEmpty(indexedData)) {\n            var now = new Date() / 1000;\n            for (var n = 0; n < dataLength; n++) {\n              var pushData = indexedData.map(function (d) {\n                return d.values[n] || {\n                  time: now,\n                  histogram: {\n                  }\n                };\n              });\n              epoch.push(pushData);\n            }\n          }\n          ctrl.renderingCompleted();\n        }\n      }\n\n      function time_format(ticks, min, max) {\n        if (min && max && ticks) {\n          var range = max - min;\n          var secPerTick = (range/ticks) / 1000;\n          var oneDay = 86400000;\n          var oneYear = 31536000000;\n\n          if (secPerTick <= 45) {\n            return 'HH:mm:ss';\n          }\n          if (secPerTick <= 7200 || range <= oneDay) {\n            return 'HH:mm';\n          }\n          if (secPerTick <= 80000) {\n            return 'M/D HH:mm';\n          }\n          if (secPerTick <= 2419200 || range <= oneYear) {\n            return 'M/D';\n          }\n          return 'YYYY-M';\n        }\n\n        return 'HH:mm';\n      }\n\n      function shouldDelayDraw(panel) {\n        if (panel.legend.rightSide) {\n          return true;\n        }\n        if (legendSideLastValue !== null && panel.legend.rightSide !== legendSideLastValue) {\n          return true;\n        }\n      }\n\n      elem.bind('plotselected', function (event, ranges) {\n        scope.$apply(function() {\n          timeSrv.setTime({\n            from  : moment.utc(ranges.xaxis.from),\n            to    : moment.utc(ranges.xaxis.to),\n          });\n        });\n      });\n    }\n  };\n});\n"]}